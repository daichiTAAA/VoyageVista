# チュートリアル - PostgreSQL
&nbsp;
# 作成記録
---
* 作成日時 2024/3/9 野田大一郎
* 更新日時
&nbsp;
# 概要
---
* このドキュメントはPostgreSQLのチュートリアルである。
&nbsp;
# 対象読者
---
* このドキュメントはPostgreSQLの使用方法を確認したいエンジニア用である。
&nbsp;
# 目的
---
* PostgreSQLの使用方法を記載する。
&nbsp;

# 内容
---
# Dockerコンテナで実行ているPotgreSQLのテーブル確認方法
Dockerコンテナで動作しているPostgreSQLデータベースの`users`テーブルを確認するためには、まずPostgreSQLデータベースが動作しているDockerコンテナに接続する必要があります。以下はその手順です：

1. **Dockerコンテナのリストを表示**：
   最初に、動作しているDockerコンテナのリストを取得します。これにより、PostgreSQLデータベースが動作しているコンテナのIDまたは名前を確認できます。
   ```sh
   docker ps
   ```

2. **Dockerコンテナに接続**：
   PostgreSQLが動作しているコンテナのIDまたは名前がわかったら、そのコンテナに接続します。以下のコマンドを使用して、bashシェル（またはshシェル）を開きます。
   ```sh
   docker exec -it <コンテナIDまたは名前> bash
   ```
   `<コンテナIDまたは名前>`を実際のコンテナのIDまたは名前に置き換えてください。

3. **PostgreSQLに接続**：
   コンテナ内で、PostgreSQLデータベースに接続します。以下のコマンドを使用して、`psql`コマンドラインツールを起動します。
   ```sh
   psql -U <ユーザー名> -d <データベース名>
   ```
   `<ユーザー名>`と`<データベース名>`を適切な値に置き換えてください。デフォルトのユーザー名は多くの場合`postgres`です。

4. **`users`テーブルを確認**：
   PostgreSQLのプロンプトが表示されたら、以下のコマンドを使用して`users`テーブルの構造を確認できます。
   ```sql
   \d users
   ```
   または、`users`テーブルの内容を表示するには、以下のSQLクエリを実行します。
   ```sql
   SELECT * FROM users;
   ```

これらの手順により、Dockerコンテナ内で動作しているPostgreSQLデータベースの`users`テーブルの構造や内容を確認することができます。

# テーブルを削除する方法
テーブルを削除するには、SQLの`DROP TABLE`ステートメントを使用します。これは、指定されたテーブルをデータベースから削除します。テーブルを削除する前に、そのテーブルに重要なデータが含まれていないか、またはバックアップが必要かどうかを確認してください。テーブルを削除すると、そのテーブルのデータと構造が完全に失われます。

以下は、`users`テーブルを削除するための基本的なステップです：

1. **PostgreSQLに接続**：
   まず、PostgreSQLデータベースに接続します。Dockerを使用している場合は、上記のステップで説明したように、対象のPostgreSQLが動作しているコンテナに接続し、`psql`ツールを使用してデータベースにログインします。

2. **テーブルを削除**：
   PostgreSQLのプロンプトで、以下のコマンドを実行して`users`テーブルを削除します：
   ```sql
   DROP TABLE users;
   ```
   または、テーブルが存在する場合にのみ削除したい場合は、以下のコマンドを使用できます。これにより、テーブルが存在しない場合にエラーが発生するのを防ぐことができます。
   ```sql
   DROP TABLE IF EXISTS users;
   ```

### 注意点：
- テーブルを削除すると、そのテーブルに関連するすべてのデータが永久に失われます。操作を実行する前に、必要に応じてデータのバックアップを取ることをお勧めします。
- 他のテーブルとの外部キー制約がある場合、制約の依存関係によってはテーブルを直接削除できないことがあります。この場合、先に外部キー制約を削除するか、`CASCADE`オプションを使用して依存するオブジェクトも同時に削除する必要があります。
   ```sql
   DROP TABLE users CASCADE;
   ```
- `CASCADE`オプションを使用する場合は特に注意が必要です。これにより、指定したテーブルに依存する他のオブジェクト（例えば、外部キー制約、ビュー、ストアドプロシージャなど）も一緒に削除されるため、意図しないデータ損失を引き起こす可能性があります。

# コマンドラインツールの終了方法
PostgreSQLのコマンドラインツール`psql`との対話を終了するには、以下のコマンドを実行します：

```sql
\q
```

このコマンドは、`psql`プロンプトから直接実行でき、現在のセッションを終了してコマンドラインに戻ります。

また、PostgreSQLサーバーへの接続を終了した後、Dockerコンテナ内で作業している場合は、コンテナのシェルから抜けるには`exit`コマンドを使用します：

```sh
exit
```

これにより、コンテナのシェルセッションを終了し、ホストマシンのコマンドラインに戻ります。